<html>
<body>
<script type="vertex" id="vs">
        #version 300 es
        layout ( location=0) in vec4 position;
        layout ( location=1) in vec3 color;
        out vec3 vColor;
        uniform mat4 rotMatrix;
        void main (){
            vColor= color;
            gl_Position=rotMatrix*position;
        }

</script>
<script type="fragment" id="fs">
        #version 300 es
        precision highp float;
        in vec3 vColor;
        out vec4 fragColor;
        void main (){
            fragColor= vec4(vColor, 1.0);
        }
</script>
<canvas id="webgl-canvas"></canvas>
<script type="text/javascript" src="Common/MV.js"></script>
<script>
    let canvas = document.getElementById("webgl-canvas");
    canvas.width = 500;
    canvas.height = 500;
    let gl = canvas.getContext("webgl2");
    if ( !gl) {
        console.error("Meu deus, vc t√° com um pc antigo !!");
    }
    gl.clear(0,0,0,1);
  let vsSource = document.getElementById("vs").text.trim();
  let vertex=gl.createShader(gl.VERTEX_SHADER);
  gl.shaderSource(vertex,vsSource);
  gl.compileShader(vertex);
  if ( !gl.getShaderParameter(vertex,gl.COMPILE_STATUS)){
      console.error(gl.getShaderInfoLog(vertex));
    }
    let fsSource = document.getElementById("fs").text.trim();
    let fragment=gl.createShader(gl.FRAGMENT_SHADER);
    gl.shaderSource(fragment,fsSource);
    gl.compileShader(fragment);
    if ( !gl.getShaderParameter(fragment,gl.COMPILE_STATUS)){
        console.error(gl.getShaderInfoLog(fragment));
    }
    let program = gl.createProgram();
    gl.attachShader(program,vertex);
    gl.attachShader(program,fragment);
    gl.linkProgram(program);
    if ( !gl.getProgramParameter(program,gl.LINK_STATUS)){
        console.error(gl.getProgramInfoLog(program));
    }
    gl.useProgram(program);

    let triangles = gl.createVertexArray();
    gl.bindVertexArray(triangles);
    let positions= new Float32Array([
        -0.5,0.0,0.0,
         0.0,0.5,0.0,
         0.25,0.0,0.0,
         0.5,0.5,0.0,
         0.5,0.0,0.0,
    ]);

    let positionBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer);
    gl.bufferData(gl.ARRAY_BUFFER,positions,gl.STATIC_DRAW);
    gl.vertexAttribPointer(0,3,gl.FLOAT,false,0,0);
    gl.enableVertexAttribArray(0);

    let colors= new Float32Array([
        1.0,0.0,0.0,
        0.0,1.0,0.0,
        0.0,0.0,1.0,
        1.0,1.0,0.0,
        1.0,0.0,1.0,
    ]);

    let colorBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER,colorBuffer);
    gl.bufferData(gl.ARRAY_BUFFER,colors,gl.STATIC_DRAW);
    gl.vertexAttribPointer(1,3,gl.FLOAT,false,0,0);
    gl.enableVertexAttribArray(1);

    //let rotacao2 = rotateZ(45) //collumn major
    let rotacao = [ // row major!
        [0,-1,0,0],
        [1,0,0,0],
        [0,0,1,0],
        [0,0,0,1]] ;
    let y = flatten(rotacao);
    //let y2 =flatten(rotacao2);
    let locationRotMatrix=gl.getUniformLocation(program,"rotMatrix");
    gl.uniformMatrix4fv(locationRotMatrix,false,flatten(rotacao));
    gl.clear(gl.COLOR_BUFFER_BIT);
    gl.drawArrays(gl.TRIANGLE_STRIP,0,5);


</script>
</body>
</html>